import{r as l,j as e,E as we,t as be,a as ke,d as x,c as v,C as P,l as q,ai as E,B as p,S as Se,Y as _e,I as ye,a2 as Ae}from"./index-BgzuCSKe.js";import{T as Ce,a as De,b as H,c as Q}from"./tabs-DzQTwS6e.js";import{S as W,a as K,b as X,c as Z,d as A}from"./select-DWk-BBhH.js";import{D as Te,a as Ge,b as Fe,c as Ie}from"./dialog-AKCUCdMT.js";import{L as C}from"./label-CTTYbNyV.js";import{T as ee}from"./textarea-LixU21-h.js";import{D as z}from"./download-BdUvxDmi.js";import{E as se}from"./eye-AaGJ7QJb.js";import"./index-BZrFsnjO.js";var Oe="Separator",ae="horizontal",Pe=["horizontal","vertical"],te=l.forwardRef((c,o)=>{const{decorative:h,orientation:f=ae,...N}=c,w=Ee(f)?f:ae,D=h?{role:"none"}:{"aria-orientation":w==="vertical"?w:void 0,role:"separator"};return e.jsx(we.div,{"data-orientation":w,...D,...N,ref:o})});te.displayName=Oe;function Ee(c){return Pe.includes(c)}var re=te;const le=l.forwardRef(({className:c,orientation:o="horizontal",decorative:h=!0,...f},N)=>e.jsx(re,{ref:N,decorative:h,orientation:o,className:be("shrink-0 bg-border",o==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",c),...f}));le.displayName=re.displayName;function Ye(){const{user:c,isAdmin:o,isTeacher:h}=ke(),[f,N]=l.useState([]),[w,L]=l.useState([]),[D,ne]=l.useState([]),[j,ie]=l.useState("all"),[b,de]=l.useState("all"),[ce,oe]=l.useState([]),[me,T]=l.useState(!0),[U,ue]=l.useState("unmarked"),[G,F]=l.useState(!1),[n,xe]=l.useState(null),[m,k]=l.useState({marks:"",feedback:"",comments:""}),[S,_]=l.useState(""),[M,$]=l.useState(!1);l.useEffect(()=>{c&&(o||h)&&R()},[c,j,b,o,h,U]),l.useEffect(()=>{G||_("")},[G]);const R=async()=>{try{T(!0);const s=j!=="all"?`?courseId=${j}`:"",[r,a,u,g]=await Promise.all([x("/courses"),x("/assignments"),x(`/submissions${s}`),x("/users")]),I=new Map((r||[]).map(t=>[t.id,{title:t.title,code:t.code}])),pe=new Map((g==null?void 0:g.map(t=>[t.id,t]))||[]);ne(g||[]);const y=a?[...a]:[],je=(u==null?void 0:u.map(t=>{const d=pe.get(t.user_id);let i=y.find(Ne=>Ne.id===t.assignment_id);i||(i={id:t.assignment_id,title:t.assignment_title||"Unknown Assignment",course:"",course_code:"",points:t.points??null,due_date:null,passing_marks:null,assessment_brief:null},y.push(i));const O=I.get((i==null?void 0:i.course)||"");return{...t,user_name:(d==null?void 0:d.full_name)||"Unknown User",user_email:(d==null?void 0:d.email)||"No email",assignment_title:(i==null?void 0:i.title)||t.assignment_title,course_code:(i==null?void 0:i.course_code)||(O==null?void 0:O.code),points:(i==null?void 0:i.points)??t.points}}))||[],ge=y.filter(t=>j==="all"||t.course===j)||[];N(ge);const Y=[...new Set(y.map(t=>t.course).filter(Boolean))],ve=Y.length?Y.map(t=>{const d=I.get(t);return{id:t,name:d?`${d.title}`:t}}):Array.from(I.entries()).map(([t,d])=>({id:t,name:d.title||t}));oe(ve),L(je),T(!1)}catch(s){v.error(s.message||"Failed to fetch data"),T(!1)}},V=async(s,r)=>{var a;if(xe({assignment:s,submission:r}),k({marks:((a=r.marks_obtained)==null?void 0:a.toString())||"",feedback:r.feedback||"",comments:""}),_(""),r.file_path)try{const u=await x(`/submissions/${r.id}`),g=u.url?Ae(u.url):"";_(g)}catch(u){console.error("Error loading file preview:",u),_("")}F(!0)},he=async()=>{if(n){$(!0);try{await x(`/submissions/${n.submission.id}/grade`,{method:"POST",body:JSON.stringify({auto:!0})}),v.success("AI grading completed!")}catch(s){console.error("Auto-grading error:",s),v.error(s.message||"Failed to auto-grade assignment")}finally{$(!1)}}},fe=async()=>{if(n)try{await x(`/submissions/${n.submission.id}/grade`,{method:"POST",body:JSON.stringify({marks_obtained:parseInt(m.marks),feedback:m.feedback,status:"graded"})}),v.success("Grade saved successfully"),F(!1),await R()}catch(s){v.error(s.message||"Failed to save grade")}},B=async s=>{try{const r=await x(`/submissions/${s}`);window.open(r.url,"_blank")}catch(r){v.error(r.message||"Failed to download file")}},J=s=>{let r=w.filter(a=>a.assignment_id===s);return b!=="all"&&(r=r.filter(a=>a.user_id===b)),r};return o||h?me?e.jsx("div",{className:"p-8",children:"Loading..."}):e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Assignment Submissions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(W,{value:j,onValueChange:ie,children:[e.jsx(K,{className:"w-64",children:e.jsx(X,{placeholder:"Filter by course"})}),e.jsxs(Z,{children:[e.jsx(A,{value:"all",children:"All Courses"}),ce.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(W,{value:b,onValueChange:de,children:[e.jsx(K,{className:"w-64",children:e.jsx(X,{placeholder:"Filter by student"})}),e.jsxs(Z,{children:[e.jsx(A,{value:"all",children:"All Students"}),D.map(s=>e.jsx(A,{value:s.id,children:s.full_name||s.email},s.id))]})]})]})]}),e.jsxs(Ce,{value:U,onValueChange:s=>ue(s),children:[e.jsxs(De,{children:[e.jsx(H,{value:"unmarked",children:"Unmarked"}),e.jsx(H,{value:"marked",children:"Marked"})]}),e.jsx(Q,{value:"unmarked",className:"space-y-4",children:f.map(s=>{const r=J(s.id).filter(a=>(a.status||"").toLowerCase()!=="graded");return r.length===0?null:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.course_code})]}),e.jsx("div",{className:"space-y-3",children:r.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-amber-50 dark:bg-amber-950/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{variant:"outline",className:"bg-amber-100 dark:bg-amber-900/30",children:"Pending"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.user_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.user_email})]})]}),e.jsx("div",{className:"mt-2 flex items-center gap-4 text-sm",children:e.jsxs("span",{children:["Submitted: ",a.submitted_at?E(new Date(a.submitted_at),"PPp"):"N/A"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.file_path&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>B(a.id),children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Download"]}),e.jsxs(p,{variant:"default",size:"sm",onClick:()=>V(s,a),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Grade Now"]})]})]},a.id))})]},s.id)})}),e.jsx(Q,{value:"marked",className:"space-y-4",children:f.map(s=>{const r=J(s.id).filter(a=>(a.status||"").toLowerCase()==="graded");return r.length===0?null:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.course_code})]}),e.jsx("div",{className:"space-y-3",children:r.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-green-50 dark:bg-green-950/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{variant:"outline",className:"bg-green-100 dark:bg-green-900/30",children:"Graded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.user_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.user_email})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm",children:[e.jsxs("span",{children:["Submitted: ",a.submitted_at?E(new Date(a.submitted_at),"PPp"):"N/A"]}),e.jsxs("span",{className:"font-medium",children:["Marks: ",a.marks_obtained,"/",s.points||100]}),a.graded_at&&e.jsxs("span",{children:["Graded: ",E(new Date(a.graded_at),"PPp")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.file_path&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>B(a.id),children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Download"]}),e.jsxs(p,{variant:"default",size:"sm",onClick:()=>V(s,a),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"View/Edit Grade"]})]})]},a.id))})]},s.id)})})]}),e.jsx(Te,{open:G,onOpenChange:F,children:e.jsx(Ge,{className:"fixed inset-0 m-0 w-full h-full max-w-full max-h-full overflow-hidden rounded-none bg-background !left-0 !top-0 !translate-x-0 !translate-y-0 !max-w-full !max-h-full !w-full !h-full !rounded-none",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(Fe,{className:"px-6 pt-6 pb-0",children:e.jsxs(Ie,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Grade Submission: ",n==null?void 0:n.assignment.title]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:he,disabled:M,className:"ml-4",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),M?"AI Grading...":"Auto Grade with AI"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(_e,{className:"h-4 w-4"}),"Assignment Preview"]}),S&&e.jsx("div",{className:"flex justify-end px-2",children:e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>window.open(S,"_blank"),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Open in new tab"]})}),e.jsx(P,{className:"p-0 overflow-hidden",children:S?e.jsx("iframe",{src:S,className:"w-full min-h-[500px] border-0",title:"Assignment Preview"}):e.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"Loading preview..."})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Grading Details"}),e.jsxs("div",{children:[e.jsx(C,{children:"Student"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("p",{className:"font-medium",children:n==null?void 0:n.submission.user_name}),e.jsx("p",{className:"text-muted-foreground",children:n==null?void 0:n.submission.user_email})]})]}),e.jsx(le,{}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"marks",children:"Marks Obtained"}),e.jsx(ye,{id:"marks",type:"number",value:m.marks,onChange:s=>k({...m,marks:s.target.value}),placeholder:`Out of ${n==null?void 0:n.assignment.points}`,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"feedback",children:"Feedback"}),e.jsx(ee,{id:"feedback",value:m.feedback,onChange:s=>k({...m,feedback:s.target.value}),rows:5,placeholder:"Enter detailed feedback...",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"comments",children:"Comments"}),e.jsx(ee,{id:"comments",value:m.comments,onChange:s=>k({...m,comments:s.target.value}),rows:3,placeholder:"Additional comments...",className:"mt-1"})]}),e.jsx(p,{onClick:fe,className:"w-full",size:"lg",children:"Save Grade"})]})]})})]})})})]}):e.jsx("div",{className:"p-8",children:e.jsx("p",{children:"You do not have permission to view this page."})})}export{Ye as default};
