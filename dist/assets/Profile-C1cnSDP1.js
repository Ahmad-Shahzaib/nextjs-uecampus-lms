import{a as R,r as l,a2 as z,d as p,j as e,C as G,e as K,f as Q,g as W,b as X,an as Z,ao as ee,ap as ae,aq as se,B as j,I as c,c as d}from"./index-BgzuCSKe.js";import{L as m}from"./label-CTTYbNyV.js";import{S as re,a as te,b as le,c as de,d as ne}from"./select-DWk-BBhH.js";import{L as I}from"./loader-circle-DL1dP3Yd.js";import{U as P}from"./upload-_QSc8TW1.js";import"./index-BZrFsnjO.js";function xe(){const{user:s,isAdmin:n}=R(),[U,w]=l.useState(!1),[N,D]=l.useState(!1),[x,S]=l.useState(!1),[u,_]=l.useState(""),[L,F]=l.useState(""),[T,k]=l.useState(""),[C,y]=l.useState(""),[i,M]=l.useState([]),[o,E]=l.useState(""),A=l.useMemo(()=>{const a=i.find(t=>t.id===o);return(a==null?void 0:a.full_name)||(a==null?void 0:a.email)||"selected user"},[i,o]),f=l.useMemo(()=>{if(!n)return C;const a=i.find(t=>t.id===o);return(a==null?void 0:a.id_document_url)||""},[n,i,o,C]),O=l.useMemo(()=>z(f),[f]);l.useEffect(()=>{s&&V()},[s]),l.useEffect(()=>{n&&v()},[n,s]);const V=async()=>{try{_((s==null?void 0:s.full_name)||"");const a=(s==null?void 0:s.avatar_url)||"";F(a),y((s==null?void 0:s.id_document_url)||"");try{a&&localStorage.setItem("avatar_url",a)}catch{}k((s==null?void 0:s.user_code)||"Not assigned")}catch(a){console.error("Error loading profile:",a)}},v=async()=>{try{const a=await p("/users");M(a||[]),E(t=>{var r;return t||((r=a==null?void 0:a[0])==null?void 0:r.id)||(s==null?void 0:s.id)||""})}catch(a){console.error("Error loading users for ID upload:",a)}},$=async a=>{try{if(D(!0),!a.target.files||a.target.files.length===0)return;const t=a.target.files[0],r=new FormData;r.append("avatar",t);const h=await p("/profile/avatar",{method:"POST",body:r});F(h.avatar_url);try{localStorage.setItem("avatar_url",h.avatar_url)}catch{}d.success("Avatar uploaded successfully")}catch(t){console.error("Error uploading avatar:",t),d.error("Failed to upload avatar")}finally{D(!1)}},q=async a=>{var t;try{if(S(!0),!a.target.files||a.target.files.length===0)return;const r=(n?o:s==null?void 0:s.id)||(s==null?void 0:s.id)||"";if(!r){d.error("Select a user before uploading an ID document");return}const h=a.target.files[0],b=new FormData;b.append("id_document",h),b.append("user_id",r);const g=await p("/profile/id-document",{method:"POST",body:b});g!=null&&g.id_document_url&&r===(s==null?void 0:s.id)&&y(g.id_document_url);const J=((t=i.find(Y=>Y.id===r))==null?void 0:t.full_name)||r;d.success(`ID document uploaded for ${J}`),await v(),a.target.value=""}catch(r){console.error("Error uploading ID document:",r),d.error("Failed to upload ID document")}finally{S(!1)}},B=async()=>{try{w(!0),await p("/profile",{method:"PATCH",body:JSON.stringify({full_name:u})}),d.success("Profile updated successfully")}catch(a){console.error("Error updating profile:",a),d.error("Failed to update profile")}finally{w(!1)}},H=async()=>{const a=(n?o:s==null?void 0:s.id)||(s==null?void 0:s.id)||"";if(!a){d.error("Select a user before deleting an ID document");return}const t=n?`${A} (${a})`:"your account";if(confirm(`Delete ID document for ${t}? This action cannot be undone.`))try{await p("/profile/id-document",{method:"DELETE",body:JSON.stringify({user_id:a})}),a===(s==null?void 0:s.id)&&y(""),await v(),d.success("ID document deleted")}catch(r){console.error("Error deleting ID document:",r),d.error("Failed to delete ID document")}};return s?e.jsx("div",{className:"container max-w-4xl py-8",children:e.jsxs(G,{className:"border-border/50 shadow-lg",children:[e.jsxs(K,{children:[e.jsx(Q,{className:"text-2xl bg-gradient-primary bg-clip-text text-transparent",children:"Profile Settings"}),e.jsx(W,{children:"Manage your account information and preferences"})]}),e.jsxs(X,{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(Z,{className:"h-32 w-32 border-4 border-primary/20",children:[e.jsx(ee,{src:L,alt:u||"User"}),e.jsx(ae,{className:"bg-primary/10 text-primary text-2xl",children:u?u.charAt(0).toUpperCase():e.jsx(se,{className:"h-12 w-12"})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"avatar-upload",className:"cursor-pointer",children:e.jsx(j,{variant:"outline",disabled:N,className:"relative",asChild:!0,children:e.jsx("span",{children:N?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Upload Avatar"]})})})}),e.jsx(c,{id:"avatar-upload",type:"file",accept:"image/*",onChange:$,className:"hidden",disabled:N})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"userId",children:"User ID"}),e.jsx(c,{id:"userId",type:"text",value:T,disabled:!0,className:"bg-muted/50"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your unique user identifier assigned by the administrator."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"Email Address"}),e.jsx(c,{id:"email",type:"email",value:s.email||"",disabled:!0,className:"bg-muted/50"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed. Contact administrator if needed."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"fullName",children:"Full Name"}),e.jsx(c,{id:"fullName",type:"text",value:u,onChange:a=>_(a.target.value),placeholder:"Enter your full name"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"You can edit your name."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"password",children:"Password"}),e.jsx(c,{id:"password",type:"password",value:"••••••••",disabled:!0,className:"bg-muted/50"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact administrator to reset your password."})]})]}),e.jsxs("div",{className:"space-y-2 border rounded-lg p-4 bg-muted/20",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"ID Document"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Visible to students when uploaded"})]}),n&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"min-w-[200px]",children:[e.jsxs(re,{value:o,onValueChange:E,children:[e.jsx(te,{className:"w-full",children:e.jsx(le,{placeholder:"Select student"})}),e.jsx(de,{children:i.map(a=>e.jsx(ne,{value:a.id,children:a.full_name||a.email||a.user_code||"Unknown user"},a.id))})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Uploading ID for ",A]})]}),e.jsx(m,{htmlFor:"id-upload",className:"cursor-pointer mb-0",children:e.jsx(j,{variant:"outline",disabled:x,className:"min-w-[120px]",asChild:!0,children:e.jsx("span",{children:x?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Upload ID"]})})})}),e.jsx(c,{id:"id-upload",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:q,className:"hidden",disabled:x}),e.jsx(j,{type:"button",variant:"outline",onClick:H,disabled:x||!f,className:"min-w-[120px]",children:"Delete ID"})]})]}),f?e.jsx("a",{href:O,target:"_blank",rel:"noreferrer",className:"text-primary text-sm underline",children:"View uploaded ID document"}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No ID document uploaded yet."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{onClick:B,disabled:U,className:"min-w-32",children:U?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})})]})]})}):null}export{xe as default};
