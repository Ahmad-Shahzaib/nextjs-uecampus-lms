import{i as ce,y as q,r as o,H as P,j as e,E as C,F as E,G as ue,O as pe,at as Y,au as me,z as fe,av as he,aw as xe,t as B,ax as ye,a as ve,d as G,c as j,B as R,I as _,V as F,C as ge,b as be}from"./index-BgzuCSKe.js";import{D as T,d as je,a as M,b as U,c as O}from"./dialog-AKCUCdMT.js";import{L as w}from"./label-CTTYbNyV.js";import{T as Ne}from"./textarea-LixU21-h.js";import{u as we}from"./index-BZrFsnjO.js";import{U as Re}from"./upload-_QSc8TW1.js";import{Y as _e}from"./youtube-ag8kwuy5.js";import{T as Ce}from"./trash-2-nf0tJxYl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=ce("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);var D="Radio",[Se,z]=q(D),[Ge,Ee]=Se(D),K=o.forwardRef((i,d)=>{const{__scopeRadio:r,name:u,checked:a=!1,required:c,disabled:p,value:y="on",onCheck:h,form:v,...g}=i,[x,l]=o.useState(null),n=P(d,b=>l(b)),t=o.useRef(!1),f=x?v||!!x.closest("form"):!0;return e.jsxs(Ge,{scope:r,checked:a,disabled:p,children:[e.jsx(C.button,{type:"button",role:"radio","aria-checked":a,"data-state":X(a),"data-disabled":p?"":void 0,disabled:p,value:y,...g,ref:n,onClick:E(i.onClick,b=>{a||h==null||h(),f&&(t.current=b.isPropagationStopped(),t.current||b.stopPropagation())})}),f&&e.jsx(W,{control:x,bubbles:!t.current,name:u,value:y,checked:a,required:c,disabled:p,form:v,style:{transform:"translateX(-100%)"}})]})});K.displayName=D;var $="RadioIndicator",H=o.forwardRef((i,d)=>{const{__scopeRadio:r,forceMount:u,...a}=i,c=Ee($,r);return e.jsx(ue,{present:u||c.checked,children:e.jsx(C.span,{"data-state":X(c.checked),"data-disabled":c.disabled?"":void 0,...a,ref:d})})});H.displayName=$;var Ie="RadioBubbleInput",W=o.forwardRef(({__scopeRadio:i,control:d,checked:r,bubbles:u=!0,...a},c)=>{const p=o.useRef(null),y=P(p,c),h=we(r),v=pe(d);return o.useEffect(()=>{const g=p.current;if(!g)return;const x=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(x,"checked").set;if(h!==r&&n){const t=new Event("click",{bubbles:u});n.call(g,r),g.dispatchEvent(t)}},[h,r,u]),e.jsx(C.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...a,tabIndex:-1,ref:y,style:{...a.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});W.displayName=Ie;function X(i){return i?"checked":"unchecked"}var Pe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],S="RadioGroup",[De,ze]=q(S,[Y,z]),J=Y(),Q=z(),[Le,ke]=De(S),Z=o.forwardRef((i,d)=>{const{__scopeRadioGroup:r,name:u,defaultValue:a,value:c,required:p=!1,disabled:y=!1,orientation:h,dir:v,loop:g=!0,onValueChange:x,...l}=i,n=J(r),t=me(v),[f,b]=fe({prop:c,defaultProp:a??null,onChange:x,caller:S});return e.jsx(Le,{scope:r,name:u,required:p,disabled:y,value:f,onValueChange:b,children:e.jsx(he,{asChild:!0,...n,orientation:h,dir:t,loop:g,children:e.jsx(C.div,{role:"radiogroup","aria-required":p,"aria-orientation":h,"data-disabled":y?"":void 0,dir:t,...l,ref:d})})})});Z.displayName=S;var ee="RadioGroupItem",se=o.forwardRef((i,d)=>{const{__scopeRadioGroup:r,disabled:u,...a}=i,c=ke(ee,r),p=c.disabled||u,y=J(r),h=Q(r),v=o.useRef(null),g=P(d,v),x=c.value===a.value,l=o.useRef(!1);return o.useEffect(()=>{const n=f=>{Pe.includes(f.key)&&(l.current=!0)},t=()=>l.current=!1;return document.addEventListener("keydown",n),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",n),document.removeEventListener("keyup",t)}},[]),e.jsx(xe,{asChild:!0,...y,focusable:!p,active:x,children:e.jsx(K,{disabled:p,required:c.required,checked:x,...h,...a,name:c.name,ref:g,onCheck:()=>c.onValueChange(a.value),onKeyDown:E(n=>{n.key==="Enter"&&n.preventDefault()}),onFocus:E(a.onFocus,()=>{var n;l.current&&((n=v.current)==null||n.click())})})})});se.displayName=ee;var Ae="RadioGroupIndicator",te=o.forwardRef((i,d)=>{const{__scopeRadioGroup:r,...u}=i,a=Q(r);return e.jsx(H,{...a,...u,ref:d})});te.displayName=Ae;var re=Z,ae=se,Fe=te;const oe=o.forwardRef(({className:i,...d},r)=>e.jsx(re,{className:B("grid gap-2",i),...d,ref:r}));oe.displayName=re.displayName;const I=o.forwardRef(({className:i,...d},r)=>e.jsx(ae,{ref:r,className:B("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),...d,children:e.jsx(Fe,{className:"flex items-center justify-center",children:e.jsx(ye,{className:"h-2.5 w-2.5 fill-current text-current"})})}));I.displayName=ae.displayName;function Ke({isAdmin:i,maxDisplay:d,showUploadButton:r=!0}){const{user:u}=ve(),[a,c]=o.useState([]),[p,y]=o.useState(!0),[h,v]=o.useState(!1),[g,x]=o.useState(!1),[l,n]=o.useState(null),[t,f]=o.useState({title:"",description:"",guide_type:"youtube",file:null,youtube_url:"",duration:""});o.useEffect(()=>{u&&b()},[u]);const b=async()=>{try{y(!0);const s=await G("/lms-guides");c(s||[])}catch(s){console.error("Error loading LMS guides:",s),j.error("Failed to load LMS guides")}finally{y(!1)}},L=s=>{const m=s.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);return m?m[1]:null},ie=s=>{if(s.target.files&&s.target.files[0]){const m=s.target.files[0];if(!m.type.startsWith("video/")){j.error("Please upload a video file");return}f({...t,file:m})}},le=async s=>{if(s.preventDefault(),t.guide_type==="youtube"&&!t.youtube_url){j.error("Please enter a YouTube URL");return}if(t.guide_type==="video"&&!t.file){j.error("Please select a video file");return}x(!0);try{let m=null;if(t.guide_type==="youtube"){const A=L(t.youtube_url);if(!A){j.error("Invalid YouTube URL");return}m=`https://img.youtube.com/vi/${A}/maxresdefault.jpg`}const N=new FormData;N.append("title",t.title),N.append("description",t.description),N.append("guide_type",t.guide_type),N.append("youtube_url",t.guide_type==="youtube"?t.youtube_url:""),m&&N.append("thumbnail_url",m),t.duration&&N.append("duration",t.duration),t.guide_type==="video"&&t.file&&N.append("file",t.file),await G("/lms-guides",{method:"POST",body:N}),j.success("Guide uploaded successfully"),v(!1),f({title:"",description:"",guide_type:"youtube",file:null,youtube_url:"",duration:""}),b()}catch(m){console.error("Error uploading guide:",m),j.error(m.message||"Failed to upload guide")}finally{x(!1)}},ne=async s=>{if(confirm("Are you sure you want to delete this guide?"))try{await G(`/lms-guides/${s.id}`,{method:"DELETE"}),j.success("Guide deleted successfully"),b()}catch(m){console.error("Error deleting guide:",m),j.error(m.message||"Failed to delete guide")}},de=async s=>{(s.guide_type==="youtube"||s.file_path)&&n(s)};if(p)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const k=d?a.slice(0,d):a;return e.jsxs("div",{className:"space-y-6",children:[r&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"LMS Learning Guides"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Video tutorials available for all users"})]}),i&&e.jsxs(T,{open:h,onOpenChange:v,children:[e.jsx(je,{asChild:!0,children:e.jsxs(R,{className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Add Guide"]})}),e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(O,{children:"Add LMS Learning Guide"})}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Guide Type *"}),e.jsxs(oe,{value:t.guide_type,onValueChange:s=>f({...t,guide_type:s}),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{value:"youtube",id:"youtube"}),e.jsx(w,{htmlFor:"youtube",children:"YouTube Video"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{value:"video",id:"video"}),e.jsx(w,{htmlFor:"video",children:"Upload Video File"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Title *"}),e.jsx(_,{value:t.title,onChange:s=>f({...t,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Description"}),e.jsx(Ne,{value:t.description,onChange:s=>f({...t,description:s.target.value}),rows:3})]}),t.guide_type==="youtube"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"YouTube URL *"}),e.jsx(_,{type:"url",value:t.youtube_url,onChange:s=>f({...t,youtube_url:s.target.value}),placeholder:"https://www.youtube.com/watch?v=...",required:!0})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Upload Video File *"}),e.jsx(_,{type:"file",accept:"video/*",onChange:ie,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Duration (minutes)"}),e.jsx(_,{type:"number",value:t.duration,onChange:s=>f({...t,duration:s.target.value}),placeholder:"e.g., 30"})]}),e.jsx(R,{type:"submit",className:"w-full",disabled:g,children:g?"Adding...":"Add Guide"})]})]})]})]}),k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No LMS guides available yet"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map(s=>e.jsx(ge,{className:"border-border/50 hover:shadow-lg transition-shadow overflow-hidden",children:e.jsxs(be,{className:"p-0",children:[e.jsxs("div",{className:"relative w-full h-48 bg-muted flex items-center justify-center",children:[s.thumbnail_url?e.jsx("img",{src:s.thumbnail_url,alt:s.title,className:"w-full h-full object-cover"}):e.jsx(F,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(V,{className:"h-16 w-16 text-white"})}),s.guide_type==="youtube"&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(_e,{className:"h-6 w-6 text-red-500 bg-white rounded"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold line-clamp-2",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:s.description}),s.duration&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Duration: ",s.duration," minutes"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>de(s),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Watch"]}),i&&e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>ne(s),className:"text-destructive",children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})]})},s.id))}),e.jsx(T,{open:!!l,onOpenChange:()=>n(null),children:e.jsxs(M,{className:"max-w-5xl h-[80vh]",children:[e.jsx(U,{children:e.jsx(O,{children:l==null?void 0:l.title})}),l&&e.jsx("div",{className:"flex-1 overflow-hidden",children:l.guide_type==="youtube"&&l.youtube_url?e.jsx("iframe",{src:`https://www.youtube.com/embed/${L(l.youtube_url)}`,className:"w-full h-full border-0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:l.title}):e.jsx("video",{src:l.file_path||"",controls:!0,className:"w-full h-full",children:"Your browser does not support the video tag."})})]})})]})}export{Ke as L,V as P,oe as R,I as a};
