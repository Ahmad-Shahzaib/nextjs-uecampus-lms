import{i as ee,y as se,r as u,j as e,E as O,t as re,a as ae,d as I,C as v,b as h,o as te,n as oe,N as le,e as ne,f as ie}from"./index-BgzuCSKe.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=ee("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var S="Progress",M=100,[de,fe]=se(S),[me,ue]=de(S),D=u.forwardRef((r,a)=>{const{__scopeProgress:d,value:i=null,max:n,getValueLabel:p=pe,..._}=r;(n||n===0)&&!k(n)&&console.error(xe(`${n}`,"Progress"));const t=k(n)?n:M;i!==null&&!F(i,t)&&console.error(ge(`${i}`,"Progress"));const c=F(i,t)?i:null,l=P(c)?p(c,t):void 0;return e.jsx(me,{scope:d,value:c,max:t,children:e.jsx(O.div,{"aria-valuemax":t,"aria-valuemin":0,"aria-valuenow":P(c)?c:void 0,"aria-valuetext":l,role:"progressbar","data-state":z(c,t),"data-value":c??void 0,"data-max":t,..._,ref:a})})});D.displayName=S;var U="ProgressIndicator",q=u.forwardRef((r,a)=>{const{__scopeProgress:d,...i}=r,n=ue(U,d);return e.jsx(O.div,{"data-state":z(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...i,ref:a})});q.displayName=U;function pe(r,a){return`${Math.round(r/a*100)}%`}function z(r,a){return r==null?"indeterminate":r===a?"complete":"loading"}function P(r){return typeof r=="number"}function k(r){return P(r)&&!isNaN(r)&&r>0}function F(r,a){return P(r)&&!isNaN(r)&&r<=a&&r>=0}function xe(r,a){return`Invalid prop \`max\` of value \`${r}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${M}\`.`}function ge(r,a){return`Invalid prop \`value\` of value \`${r}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${M} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var B=D,ve=q;const G=u.forwardRef(({className:r,value:a,...d},i)=>e.jsx(B,{ref:i,className:re("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...d,children:e.jsx(ve,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));G.displayName=B.displayName;function Ne(){const{user:r}=ae(),[a,d]=u.useState(!0),[i,n]=u.useState([]),[p,_]=u.useState({activeCourses:0,completedItems:0,averageProgress:0,totalPoints:0}),t=(l,w=0)=>{const f=Number(l);return Number.isFinite(f)?f:w};u.useEffect(()=>{r&&c()},[r]);const c=async()=>{try{d(!0);const[l,w,f]=await Promise.all([I("/progress"),I("/courses?enrolledOnly=true"),I("/enrollments")]),N=Array.from(new Map((w||[]).map(s=>[s.id,s])).values()),K=new Map(N.map(s=>[s.id,s.title])),g=(f||[]).filter(s=>!s.status||s.status==="active"),X=Array.from(new Set(g.map(s=>s.course_id).filter(Boolean))),H=new Map(g.map(s=>[s.course_id,t(s.progress,0)])),J=g.length?Math.round(g.reduce((s,o)=>s+t(o.progress,0),0)/g.length):0,A=(l||[]).map(s=>({id:s.id,course_id:s.course_id,course_name:K.get(s.course_id)||"Unknown Course",item_type:s.item_type,material_id:s.material_id||void 0,score:t(s.score,0),max_score:t(s.max_score,100),percentage:t(s.percentage,0),status:s.status,completed_at:s.completed_at})),Q=A.filter(s=>{const o=(s.item_type||"").toLowerCase();return o==="assignment"||o==="quiz"}),W=new Set(A.filter(s=>(s.item_type||"").toLowerCase()==="material"&&s.status==="completed").map(s=>String(s.material_id||s.id))),$=new Set;r!=null&&r.id&&N.forEach(s=>{const o=`completed_materials_${r.id}_${s.id}`,y=localStorage.getItem(o);if(y)try{const x=JSON.parse(y);Array.isArray(x)&&x.forEach(b=>$.add(String(b)))}catch(x){console.error("Failed to parse local progress cache",x)}});const E=new Set([...Array.from(W),...Array.from($)]).size,j=N.map(s=>{const o=Q.filter(m=>m.course_id===s.id),y=o.filter(m=>m.item_type==="assignment"&&m.status==="completed").length,x=o.reduce((m,C)=>m+t(C.score,0),0),b=o.length===0?0:o.reduce((m,C)=>m+t(C.percentage,0),0)/o.length,T=H.get(s.id),L=r!=null&&r.id?`course_progress_${r.id}_${s.id}`:"",R=L?localStorage.getItem(L):null,V=R!==null?t(R,0):void 0,Z=V!==void 0?V:T!==void 0?T:Number.isFinite(b)?Math.round(b):0;return{course_id:s.id,course_name:s.title,overall_progress:Z,assignments_completed:y,total_score:x}});n(j);const Y=j.length?Math.round(j.reduce((s,o)=>s+t(o.overall_progress,0),0)/j.length):0;_({activeCourses:X.length||N.length,completedItems:E,averageProgress:Y||J,totalPoints:E*2})}catch(l){console.error("Error loading progress:",l)}finally{d(!1)}};return a?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-primary bg-clip-text text-transparent",children:"My Progress"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your learning progress and achievements"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(v,{className:"border-border/50",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:e.jsx(te,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.activeCourses}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Courses"})]})]})})}),e.jsx(v,{className:"border-border/50",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-success/10",children:e.jsx(oe,{className:"h-6 w-6 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.completedItems}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed Items"})]})]})})}),e.jsx(v,{className:"border-border/50",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-accent/10",children:e.jsx(ce,{className:"h-6 w-6 text-accent"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(p.averageProgress),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Progress"})]})]})})}),e.jsx(v,{className:"border-border/50",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-warning/10",children:e.jsx(le,{className:"h-6 w-6 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.totalPoints}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Points"})]})]})})})]}),e.jsx("div",{className:"space-y-4",children:i.map(l=>e.jsxs(v,{className:"border-border/50",children:[e.jsx(ne,{children:e.jsx(ie,{className:"text-lg",children:l.course_name})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Overall Progress"}),e.jsxs("span",{className:"font-semibold",children:[l.overall_progress,"%"]})]}),e.jsx(G,{value:l.overall_progress,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Assignments"}),e.jsx("p",{className:"font-semibold",children:l.assignments_completed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Score"}),e.jsxs("p",{className:"font-semibold",children:[l.total_score," pts"]})]})]})]})]},l.course_id))})]})}export{Ne as default};
