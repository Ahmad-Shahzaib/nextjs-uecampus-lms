import{i as le,r as n,a as R,j as e,S as oe,k as ie,u as ne,d as i,l as Q,P as ce,C as c,m as de,n as me,o as he,B as x,I as T,c as y}from"./index-BgzuCSKe.js";import{D as ue,a as xe,b as ge,c as fe}from"./dialog-AKCUCdMT.js";import{L as pe}from"./LMSGuides-CngONoKx.js";import{C as je}from"./circle-alert-CK-aD36C.js";import{C as Ne}from"./copy-yeOzg1fM.js";import{T as ye}from"./trash-2-nf0tJxYl.js";import"./label-CTTYbNyV.js";import"./textarea-LixU21-h.js";import"./index-BZrFsnjO.js";import"./upload-_QSc8TW1.js";import"./youtube-ag8kwuy5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=le("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);function be(){const[g,f]=n.useState(!1),{user:d}=R(),[v,a]=n.useState("Student");return n.useEffect(()=>{if(d!=null&&d.full_name&&a(d.full_name),!sessionStorage.getItem("hasSeenWelcome")&&d){const p=setTimeout(()=>{f(!0),sessionStorage.setItem("hasSeenWelcome","true")},800);return()=>clearTimeout(p)}},[d]),e.jsx(ue,{open:g,onOpenChange:f,children:e.jsx(xe,{className:"sm:max-w-md border-primary/50 bg-gradient-hero shadow-glow",children:e.jsxs(ge,{className:"space-y-6 text-center",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-primary flex items-center justify-center shadow-glow animate-pulse",children:e.jsx(oe,{className:"h-10 w-10 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 rounded-full bg-accent flex items-center justify-center animate-bounce",children:e.jsx("span",{className:"text-lg",children:"ðŸŽ‰"})})]})}),e.jsxs(fe,{className:"text-3xl font-bold bg-gradient-primary bg-clip-text text-transparent",children:["Welcome, ",v,"!"]}),e.jsx("p",{className:"text-foreground text-lg",children:"Ready to continue your learning journey?"})]})})})}function $e(){const{isEditMode:g,isAdmin:f,isEditor:d}=ie(),v=f||d,{user:a}=R(),z=ne(),[p,P]=n.useState([]),[b,U]=n.useState({totalActivity:0,inProgress:0,completed:0,totalCourses:0});n.useState(!1);const[I,G]=n.useState([]),[$,H]=n.useState([]),[w,O]=n.useState(null);n.useEffect(()=>{a&&(S(),J(),V())},[a,v]);const S=async()=>{if(a)try{const[s,r,j]=await Promise.allSettled([i("/courses?enrolledOnly=true"),i("/enrollments"),i(`/dashboard/stats?scope=personal${a!=null&&a.id?`&user_id=${a.id}`:""}`)]);let l=s.status==="fulfilled"?s.value:[];const q=r.status==="fulfilled"?r.value:[],A=j.status==="fulfilled"?j.value:null,N={};q.forEach(t=>{if(!(t!=null&&t.course_id))return;const o=N[t.course_id];(!o||(t.progress||0)>(o.progress||0))&&(N[t.course_id]=t)});const E=Object.keys(N).filter(Boolean),C={};(l||[]).forEach(t=>{C[t.id]=t});let h=[];if(E.length){const t=E.filter(o=>!C[o]);t.length&&(await Promise.all(t.map(u=>i(`/courses/${u}`).catch(()=>null)))).filter(Boolean).forEach(u=>{C[u.id]=u}),h=E.map(o=>C[o]).filter(Boolean)}if(!h.length&&(l!=null&&l.length)&&(h=l),!h.length&&v)try{h=await i("/courses")||[],l=h}catch(t){console.error("Failed to load all courses for admin fallback",t)}const m=(h||[]).slice(0,6).map(t=>{var W;const o=((W=N[t.id])==null?void 0:W.progress)||t.progress||0,u=a!=null&&a.id?`course_progress_${a.id}_${t.id}`:"",F=u?localStorage.getItem(u):null,k=[F!==null?Number(F):void 0,o].filter(_=>_!==void 0),L=k.find(_=>Number(_)>0),re=L!==void 0?Number(L):k.length?Number(k[0]):0;return{...t,progress:re}});P(t=>m.length?m:t);const ee=Object.values(N).filter(t=>t.status==="active"||!t.status),se=m.length||(l==null?void 0:l.length)||0,B=ee.length||se,M=m.filter(t=>(t.progress||0)>=100).length,te=Math.max(B-M,0),ae=m.length?Math.round(m.reduce((t,o)=>t+Number(o.progress||0),0)/m.length):0;U({totalActivity:m.length?ae:(A==null?void 0:A.total_activity)??0,inProgress:te,completed:M,totalCourses:B})}catch(s){console.error("Error fetching dashboard data:",s)}},J=async()=>{if(a)try{const s=await i("/assignments");G(s||[])}catch(s){console.error("Error fetching assignments:",s)}},V=async()=>{if(a)try{const s=await i("/quizzes");H(s||[])}catch(s){console.error("Error fetching quizzes:",s)}},D=async(s,r,j)=>{try{await i(`/courses/${s}`,{method:"PATCH",body:JSON.stringify({[r]:j})}),P(p.map(l=>l.id===s?{...l,[r]:j}:l))}catch(l){y.error("Failed to update course"),console.error(l)}},K=async s=>{try{await i(`/courses/${s}`,{method:"DELETE"}),P(p.filter(r=>r.id!==s)),y.success("Course deleted"),await S()}catch{y.error("Failed to delete course")}},Y=async s=>{try{await i("/courses",{method:"POST",body:JSON.stringify({title:`${s.title} (Copy)`,code:`${s.code}-COPY-${Date.now()}`,progress:s.progress,instructor:s.instructor,next_class:s.next_class,grade:s.grade,category:"Bachelor's Programs",status:"active"})}),S(),y.success("Course duplicated")}catch{y.error("Failed to duplicate course")}},X=s=>e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.title||"Untitled Assignment"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Points: ",s.points??"N/A"," Â· Attempts: ",s.attempts??0]})]}),s.due_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Due ",new Date(s.due_date).toLocaleDateString()]})]})},(s==null?void 0:s.id)||(s==null?void 0:s.title)),Z=s=>e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.title||"Untitled Quiz"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Duration: ",s.duration??"N/A"," mins"]})]}),s.due_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Due ",new Date(s.due_date).toLocaleDateString()]})]})},(s==null?void 0:s.id)||(s==null?void 0:s.title));return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx(be,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),g&&e.jsxs(Q,{variant:"outline",className:"animate-pulse",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Edit Mode Active"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(c,{className:"p-6 bg-gradient-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm text-muted-foreground",children:"Total Activity"}),e.jsx(de,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"text-4xl font-bold",children:[b.totalActivity,"%"]})]}),e.jsxs(c,{className:"p-6 bg-gradient-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm text-muted-foreground",children:"In Progress"}),e.jsx(je,{className:"h-4 w-4 text-primary"})]}),e.jsx("div",{className:"text-4xl font-bold",children:b.inProgress})]}),e.jsxs(c,{className:"p-6 bg-gradient-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm text-muted-foreground",children:"Completed"}),e.jsx(me,{className:"h-4 w-4 text-success"})]}),e.jsx("div",{className:"text-4xl font-bold",children:b.completed})]}),e.jsxs(c,{className:"p-6 bg-gradient-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm text-muted-foreground",children:"Total Courses"}),e.jsx(he,{className:"h-4 w-4 text-accent"})]}),e.jsx("div",{className:"text-4xl font-bold",children:b.totalCourses})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Enrolled Courses"}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:p.map(s=>e.jsxs(c,{className:"p-6 hover:shadow-glow transition-all bg-gradient-card group relative",children:[g&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(x,{onClick:()=>Y(s),size:"icon",variant:"ghost",className:"h-8 w-8",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx(x,{onClick:()=>K(s.id),size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive",children:e.jsx(ye,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-4",children:g?e.jsxs(e.Fragment,{children:[e.jsx(T,{value:s.code,onChange:r=>D(s.id,"code",r.target.value),placeholder:"Course Code"}),e.jsx(T,{value:s.title,onChange:r=>D(s.id,"title",r.target.value),placeholder:"Course Title"}),e.jsx(T,{type:"number",value:s.progress,onChange:r=>D(s.id,"progress",parseInt(r.target.value)),placeholder:"Progress %"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{variant:"secondary",children:s.code}),e.jsx("h3",{className:"text-lg font-semibold",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Progress: ",s.progress,"%"]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-200 overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#5b3fd6]",style:{width:`${s.progress}%`}})}),e.jsxs(x,{className:"w-full bg-gradient-primary",onClick:()=>z(`/courses/${s.id}`),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Continue Learning"]})]})})]},s.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Assignments & Quizzes"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:w==="assignments"?"secondary":"outline",onClick:()=>O(s=>s==="assignments"?null:"assignments"),children:"Assignments"}),e.jsx(x,{variant:w==="quizzes"?"secondary":"outline",onClick:()=>O(s=>s==="quizzes"?null:"quizzes"),children:"Quizzes"})]})]}),w&&e.jsx("div",{className:"space-y-3",children:w==="assignments"?I.length?I.map(s=>X(s)):e.jsx(c,{className:"p-4 text-sm text-muted-foreground",children:"No assignments available."}):$.length?$.map(s=>Z(s)):e.jsx(c,{className:"p-4 text-sm text-muted-foreground",children:"No quizzes available."})})]}),e.jsxs("div",{className:"space-y-4 mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"LMS Learning Guides"}),e.jsx(x,{variant:"outline",onClick:()=>window.location.href="/guides",children:"View All"})]}),e.jsx(pe,{isAdmin:f,maxDisplay:3,showUploadButton:!1})]})]})}export{$e as default};
