import{a as q,r as o,d as h,c as l,j as e,B as c,I as m,V as T,C as $,b as z,k as B}from"./index-BgzuCSKe.js";import{R as W,a as E,P as G,L as H}from"./LMSGuides-CngONoKx.js";import{D as U,d as J,a as D,b as L,c as S}from"./dialog-AKCUCdMT.js";import{L as d}from"./label-CTTYbNyV.js";import{T as K}from"./textarea-LixU21-h.js";import{U as Q}from"./upload-_QSc8TW1.js";import{Y as X}from"./youtube-ag8kwuy5.js";import{T as Z}from"./trash-2-nf0tJxYl.js";import{T as ee,a as se,b as F,c as V}from"./tabs-DzQTwS6e.js";import"./index-BZrFsnjO.js";function te({isAdmin:n,maxDisplay:x,showUploadButton:Y=!0}){const{user:f}=q(),[g,A]=o.useState([]),[R,j]=o.useState(!0),[I,y]=o.useState(!1),[b,v]=o.useState(!1),[i,N]=o.useState(null),[t,u]=o.useState({title:"",description:"",guide_type:"youtube",file:null,youtube_url:"",duration:""});o.useEffect(()=>{f&&p()},[f]);const p=async()=>{try{j(!0);const s=await h("/uecampus-guides");A(s||[])}catch(s){console.error("Error loading UECampus guides:",s),l.error("Failed to load UECampus guides")}finally{j(!1)}},w=s=>{const a=s.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);return a?a[1]:null},P=s=>{if(s.target.files&&s.target.files[0]){const a=s.target.files[0];if(!a.type.startsWith("video/")){l.error("Please upload a video file");return}u({...t,file:a})}},O=async s=>{if(s.preventDefault(),t.guide_type==="youtube"&&!t.youtube_url){l.error("Please enter a YouTube URL");return}if(t.guide_type==="video"&&!t.file){l.error("Please select a video file");return}v(!0);try{let a=null;if(t.guide_type==="youtube"){const C=w(t.youtube_url);if(!C){l.error("Invalid YouTube URL");return}a=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`}const r=new FormData;r.append("title",t.title),r.append("description",t.description),r.append("guide_type",t.guide_type),r.append("youtube_url",t.guide_type==="youtube"?t.youtube_url:""),a&&r.append("thumbnail_url",a),t.duration&&r.append("duration",t.duration),t.guide_type==="video"&&t.file&&r.append("file",t.file),await h("/uecampus-guides",{method:"POST",body:r}),l.success("Guide uploaded successfully"),y(!1),u({title:"",description:"",guide_type:"youtube",file:null,youtube_url:"",duration:""}),p()}catch(a){console.error("Error uploading guide:",a),l.error(a.message||"Failed to upload guide")}finally{v(!1)}},k=async s=>{if(confirm("Are you sure you want to delete this guide?"))try{await h(`/uecampus-guides/${s.id}`,{method:"DELETE"}),l.success("Guide deleted successfully"),p()}catch(a){console.error("Error deleting guide:",a),l.error(a.message||"Failed to delete guide")}},M=async s=>{N(s)};if(R)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const _=x?g.slice(0,x):g;return e.jsxs("div",{className:"space-y-6",children:[Y&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"UECampus Guides"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Admin-uploaded video tutorials"})]}),n&&e.jsxs(U,{open:I,onOpenChange:y,children:[e.jsx(J,{asChild:!0,children:e.jsxs(c,{className:"gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Add Guide"]})}),e.jsxs(D,{children:[e.jsx(L,{children:e.jsx(S,{children:"Add UECampus Guide"})}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Guide Type *"}),e.jsxs(W,{value:t.guide_type,onValueChange:s=>u({...t,guide_type:s}),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{value:"youtube",id:"youtube"}),e.jsx(d,{htmlFor:"youtube",children:"YouTube Video"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{value:"video",id:"video"}),e.jsx(d,{htmlFor:"video",children:"Upload Video File"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Title *"}),e.jsx(m,{value:t.title,onChange:s=>u({...t,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Description"}),e.jsx(K,{value:t.description,onChange:s=>u({...t,description:s.target.value}),rows:3})]}),t.guide_type==="youtube"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"YouTube URL *"}),e.jsx(m,{type:"url",value:t.youtube_url,onChange:s=>u({...t,youtube_url:s.target.value}),placeholder:"https://www.youtube.com/watch?v=...",required:!0})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Upload Video File *"}),e.jsx(m,{type:"file",accept:"video/*",onChange:P,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Duration (minutes)"}),e.jsx(m,{type:"number",value:t.duration,onChange:s=>u({...t,duration:s.target.value}),placeholder:"e.g., 30"})]}),e.jsx(c,{type:"submit",className:"w-full",disabled:b,children:b?"Adding...":"Add Guide"})]})]})]})]}),_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No UECampus guides available yet"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map(s=>e.jsx($,{className:"border-border/50 hover:shadow-lg transition-shadow overflow-hidden",children:e.jsxs(z,{className:"p-0",children:[e.jsxs("div",{className:"relative w-full h-48 bg-muted flex items-center justify-center",children:[s.thumbnail_url?e.jsx("img",{src:s.thumbnail_url,alt:s.title,className:"w-full h-full object-cover"}):e.jsx(T,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(G,{className:"h-16 w-16 text-white"})}),s.guide_type==="youtube"&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(X,{className:"h-6 w-6 text-red-500 bg-white rounded"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold line-clamp-2",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:s.description}),s.duration&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Duration: ",s.duration," minutes"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>M(s),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Watch"]}),n&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>k(s),className:"text-destructive",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})]})},s.id))}),e.jsx(U,{open:!!i,onOpenChange:()=>N(null),children:e.jsxs(D,{className:"max-w-5xl h-[80vh]",children:[e.jsx(L,{children:e.jsx(S,{children:i==null?void 0:i.title})}),i&&e.jsx("div",{className:"flex-1 overflow-hidden",children:i.guide_type==="youtube"&&i.youtube_url?e.jsx("iframe",{src:`https://www.youtube.com/embed/${w(i.youtube_url)}`,className:"w-full h-full border-0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:i.title}):e.jsx("video",{src:i.file_path||"",controls:!0,className:"w-full h-full",children:"Your browser does not support the video tag."})})]})})]})}function pe(){const{isAdmin:n}=B();return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-primary bg-clip-text text-transparent",children:"Learning Guides"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"LMS tutorials and UECampus video guides"})]}),e.jsxs(ee,{defaultValue:"lms-guides",className:"w-full",children:[e.jsxs(se,{className:"grid w-full max-w-xl grid-cols-2",children:[e.jsx(F,{value:"lms-guides",children:"LMS Guides"}),e.jsx(F,{value:"uecampus-guides",children:"UECampus Guides"})]}),e.jsx(V,{value:"lms-guides",className:"mt-6",children:e.jsx(H,{isAdmin:n})}),e.jsx(V,{value:"uecampus-guides",className:"mt-6",children:e.jsx(te,{isAdmin:n})})]})]})}export{pe as default};
