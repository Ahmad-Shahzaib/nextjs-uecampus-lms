import{a as z,r as l,c,j as e,B as h,I as m,p as H,C as b,l as U,q as Y,o as _,d}from"./index-BgzuCSKe.js";import{L as x}from"./label-CTTYbNyV.js";import{D as G,d as J,a as K,b as W,c as X}from"./dialog-AKCUCdMT.js";import{S as Z,a as ee,b as se,c as te,d as f}from"./select-DWk-BBhH.js";import{P as ae}from"./plus-Bn2ZrHCv.js";import{L as re}from"./loader-circle-DL1dP3Yd.js";import{C as oe}from"./copy-yeOzg1fM.js";import"./index-BZrFsnjO.js";function xe(){const{user:S,isAdmin:i}=z(),[v,N]=l.useState([]),[w,g]=l.useState(!0),[D,R]=l.useState(""),[$,A]=l.useState(!1),[r,u]=l.useState({title:"",duration:"",category:"",code:""}),[L,F]=l.useState([]),O=s=>{const t=new Set,o=[];for(const a of s||[])a!=null&&a.id&&!t.has(a.id)&&(t.add(a.id),o.push(a));return o},[P,T]=l.useState(null),p=l.useRef(0);function B(s){if(Array.isArray(s))return s;if(s&&typeof s=="object"){const t=s,o=["data","items","results","courses"];for(const a of o){const n=t[a];if(Array.isArray(n))return n}}return[]}async function E(){const s=await d("/courses");return B(s)}async function q(){const s=await d("/courses?enrolledOnly=true");return B(s)}l.useEffect(()=>{S&&j()},[S,i]);const j=async()=>{const s=++p.current;g(!0);try{if(i){const y=await E();if(s!==p.current)return;N(O(y)),g(!1);return}const[t,o]=await Promise.allSettled([E(),q()]);if(s!==p.current)return;const a=t.status==="fulfilled"?t.value:[],n=o.status==="fulfilled"?o.value:[],C=a&&a.length>0&&a||n&&n.length>0&&n||[];N(O(C)),g(!1)}catch(t){if(s!==p.current)return;console.error("Failed to load courses",t),c.error("Failed to load courses"),N([]),g(!1)}},M=async()=>{if(!r.title||!r.category||!r.duration){c.error("Please fill all required fields");return}try{const s=r.code||`${r.category.substring(0,3).toUpperCase()}-${Date.now()}`,t=await d("/courses",{method:"POST",body:{title:r.title,code:s,category:r.category,duration:r.duration,description:r.title}});if(L.length>0&&(t!=null&&t.id))for(const o of L){const a=new FormData;a.append("course_id",t.id),a.append("title",o.name),a.append("file",o),await d("/materials",{method:"POST",body:a}).catch(()=>{})}c.success("Course added successfully"),A(!1),u({title:"",duration:"",category:"",code:""}),F([]),j()}catch(s){c.error((s==null?void 0:s.message)||"Failed to add course")}},V=async s=>{if(confirm("Are you sure you want to delete this course? This action cannot be undone."))try{await d(`/courses/${s}`,{method:"DELETE"}),c.success("Course deleted"),j()}catch(t){c.error((t==null?void 0:t.message)||"Failed to delete course")}},Q=async s=>{T(s.id);try{await d(`/courses/${s.id}/duplicate`,{method:"POST"}),c.success(`Course duplicated: ${s.title}`),j()}catch(t){c.error((t==null?void 0:t.message)||"Failed to duplicate course")}finally{T(null)}},I=l.useMemo(()=>{const s=D.trim().toLowerCase();return s?v.filter(t=>{var C,y,k;const o=((C=t.title)==null?void 0:C.toLowerCase())||"",a=((y=t.description)==null?void 0:y.toLowerCase())||"",n=((k=t.code)==null?void 0:k.toLowerCase())||"";return o.includes(s)||a.includes(s)||n.includes(s)}):v},[v,D]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Course Catalog"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:i?"Manage your courses":"Browse all available courses"})]}),i&&e.jsxs(G,{open:$,onOpenChange:A,children:[e.jsx(J,{asChild:!0,children:e.jsxs(h,{className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Add New Course"]})}),e.jsxs(K,{children:[e.jsx(W,{children:e.jsx(X,{children:"Add New Course"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Course Name *"}),e.jsx(m,{value:r.title,onChange:s=>u({...r,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Duration *"}),e.jsx(m,{value:r.duration,onChange:s=>u({...r,duration:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Program Category *"}),e.jsxs(Z,{value:r.category,onValueChange:s=>u({...r,category:s}),children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Select category"})}),e.jsxs(te,{children:[e.jsx(f,{value:"Bachelor's",children:"Bachelor's Degree"}),e.jsx(f,{value:"Master's",children:"Master's Degree"}),e.jsx(f,{value:"Doctorate",children:"Doctorate"}),e.jsx(f,{value:"Diploma",children:"Diploma"}),e.jsx(f,{value:"Certificate",children:"Certificate"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Course Code (Optional)"}),e.jsx(m,{value:r.code,onChange:s=>u({...r,code:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Attachments (Optional)"}),e.jsx(m,{type:"file",multiple:!0,onChange:s=>F(Array.from(s.target.files||[]))})]}),e.jsx(h,{onClick:M,className:"w-full",children:"Add Course"})]})]})]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search courses...",value:D,onChange:s=>R(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[w&&e.jsx(b,{className:"p-12 text-center col-span-full",children:"Loading coursesâ€¦"}),!w&&I.map(s=>e.jsxs(b,{className:"h-full p-6 hover:shadow-xl transition-all",children:[e.jsx(U,{className:"mb-2",children:s.category}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:s.code}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-4",children:["Duration: ",s.duration]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{to:`/courses/${s.id}`,className:"flex-1",children:e.jsx(h,{className:"w-full",children:"View Details"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",className:"text-xs whitespace-nowrap flex items-center gap-1",onClick:()=>Q(s),disabled:P===s.id,children:P===s.id?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 animate-spin"}),"Duplicating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-3 w-3"}),"Duplicate"]})}),e.jsx(h,{variant:"outline",className:"text-xs whitespace-nowrap",onClick:()=>V(s.id),children:"Delete"})]})]})]},s.id)),!w&&I.length===0&&e.jsxs(b,{className:"p-12 text-center col-span-full",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No courses found"}),e.jsx("p",{className:"text-muted-foreground",children:i?"Add your first course to get started":"You haven't been enrolled yet"})]})]})]})}export{xe as default};
